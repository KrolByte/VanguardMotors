<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Vanguard Motors</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Rubik&display=swap" rel="stylesheet"> 

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    <style>
        /* Highlight selected thumbnail */
        #vehicleThumbnailsContainer img.thumb-active {
            border: 3px solid #007bff;
            box-sizing: border-box;
        }
        #vehicleThumbnailsContainer img { max-height: 90px; object-fit: cover; }
        /* Larger related vehicle cards for the carousel */
        .related-carousel .rent-item img { max-height: 220px; object-fit: cover; }
        .related-carousel .rent-item { min-height: 360px; display: flex; flex-direction: column; justify-content: space-between; }
        .related-carousel .rent-item h4 { font-size: 1.05rem; }
        .related-carousel .rent-item h3 { font-size: 1.15rem; }
        .owl-nav .owl-prev, .owl-nav .owl-next { background: rgba(0,0,0,0.6); color: #fff; padding: 8px 12px; border-radius: 4px; }
        .owl-nav .owl-prev i, .owl-nav .owl-next i { font-size: 16px; }
    </style>
</head>

<body>
    <!-- Topbar Start -->
    <div class="container-fluid bg-dark py-3 px-lg-5 d-none d-lg-block">
        <div class="row">
            <div class="col-md-6 text-center text-lg-left mb-2 mb-lg-0">
                <div class="d-inline-flex align-items-center">
                    <a class="text-body pr-3" href=""><i class="fa fa-phone-alt mr-2"></i>+57 000 00 00</a>
                    <span class="text-body">|</span>
                    <a class="text-body px-3" href=""><i class="fa fa-envelope mr-2"></i>VanguardMotors@concessionaire.co</a>
                    <a href="LogIn.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" fill=white class="bi bi-person-circle" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                          </svg>
                    </a>
                </div>
            </div>
            <div class="col-md-6 text-center text-lg-right">
               <div class="d-inline-flex align-items-center">
                    <a class="text-body px-3" href="https://www.facebook.com/tu-pagina" target="_blank">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a class="text-body px-3" href="https://www.twitter.com/tu-usuario" target="_blank">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a class="text-body px-3" href="https://www.linkedin.com/in/tu-perfil" target="_blank">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a class="text-body px-3" href="https://www.instagram.com/tu-usuario" target="_blank">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a class="text-body pl-3" href="https://www.youtube.com/tu-canal" target="_blank">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <div class="container-fluid position-relative nav-bar p-0">
        <div class="position-relative px-lg-5" style="z-index: 9;">
            <nav class="navbar navbar-expand-lg bg-secondary navbar-dark py-3 py-lg-0 pl-3 pl-lg-5">
                <a href="" class="navbar-brand">
                    <h1 class="text-uppercase text-primary mb-1">Vanguard Motors</h1>
                </a>
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-between px-3" id="navbarCollapse">
                    <div class="navbar-nav ml-auto py-0">
                        <a href="index.html" class="nav-item nav-link">Homepage</a>
                        <a href="car.html" class="nav-item nav-link">Vehicle catalog</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <!-- Navbar End -->

    <!-- Page Header Start -->
    <div class="container-fluid page-header">
        <h1 class="display-3 text-uppercase text-white mb-3">Vehicle Detail</h1>
        <div class="d-inline-flex text-white">
            <h6 class="text-uppercase m-0"><a class="text-white" href="index.html">Homepage</a></h6>
            <h6 class="text-body m-0 px-3">/</h6>
            <h6 class="text-uppercase m-0"><a class="text-white" href="car.html">Vehicle Catalog</a></h6>
            <h6 class="text-body m-0 px-3">/</h6>
            <h6 class="text-uppercase text-body m-0">Vehicle Detail</h6>
        </div>
    </div>
    <!-- Page Header Start -->

    <!-- Details Start -->
    <div class="container-fluid pt-5">
    <div class="container pt-5">
        <div class="row">
            <div class="col-lg-8 mb-5">
                <h1 class="display-4 text-uppercase mb-5" id="vehicleTitle">Loading...</h1>
                <div class="row mx-n2 mb-3" id="vehicleGallery">
                    <div class="col-12 text-center" id="vehicleMainImageContainer">
                        <p class="text-muted">Loading images...</p>
                    </div>
                    <div class="w-100" id="vehicleThumbnailsContainer"></div>
                </div>
                <h3 class="text-uppercase mb-3 mt-4">Description</h3>
                <p id="vehicleDescription">Loading...</p>
                <h3 class="text-uppercase mb-3 mt-4">Technical specifications</h3>
                <div class="row pt-2">
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <i class="fa fa-calendar-alt text-primary mr-2"></i>
                        <span>Year: <span id="vehicleYear">-</span></span>
                    </div>
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <i class="fa fa-paint-brush text-primary mr-2"></i>
                        <span>Color: <span id="vehicleColor">-</span></span>
                    </div>
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <i class="fa fa-check-circle text-success mr-2"></i>
                        <span>Availability: <span id="vehicleAvailability">-</span></span>
                    </div>
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <i class="fa fa-tag text-primary mr-2"></i>
                        <span>Price: $<span id="vehiclePrice">-</span></span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 mb-5">
                <div class="bg-secondary p-5">
                    <h3 class="text-primary text-center mb-4">purchase options</h3>
                    <div class="form-group mb-4">
                        <a href="booking.html" class="btn btn-primary btn-block" style="height: 50px; font-size: 1.25rem;" id="reserveBtn">
                            <i class="fa fa-calendar-alt mr-2"></i>Reserve
                        </a>
                    </div>
                    <div class="form-group mb-0">
                        <a href="quote.html" class="btn btn-dark btn-block" style="height: 50px; font-size: 1.25rem;" id="quoteBtn">
                            <i class="fa fa-clipboard-list mr-2"></i>Request quote
                        </a>
                    </div>
                    <p class="text-center text-muted mt-3 mb-0"><small>We will redirect you to a form</small></p>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- Details End -->

    <!-- Related vehicles Start -->
    <div class="container-fluid pb-5">
        <div class="container pb-5">
            <h2 class="mb-4">Related vehicles</h2>
            <div class="owl-carousel related-carousel position-relative" style="padding: 0 30px;" id="relatedVehiclesContainer">
                <div class="text-center">
                    <p class="text-muted">Loading related vehicles...</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Related vehicles End -->

    <!-- Vendor Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <div class="owl-carousel vendor-carousel">
                <div class="bg-light p-4">
                    <img src="img/vendor-1.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-2.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-3.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-4.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-5.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-6.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-7.png" alt="">
                </div>
                <div class="bg-light p-4">
                    <img src="img/vendor-8.png" alt="">
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-secondary py-5 px-sm-3 px-md-5" style="margin-top: 90px;">
        <div class="row pt-5">
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Get In Touch</h4>
                <p class="mb-2"><i class="fa fa-map-marker-alt text-white mr-3"></i>Poblado, Medellín</p>
                <p class="mb-2"><i class="fa fa-phone-alt text-white mr-3"></i>+57 000 00 00</p>
                <p><i class="fa fa-envelope text-white mr-3"></i>info@concessionaire.co</p>
                <h6 class="text-uppercase text-white py-2">Follow Us</h6>
                <div class="d-flex justify-content-start">
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square" href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <!--usefull links: poner algunos servicios como mantenimiento, reparación y que redireccione directamente al chat de contactenos-->
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Usefull Links</h4>
                <div class="d-flex flex-column justify-content-start">
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Private Policy</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Term & Conditions</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>New Member Registration</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Affiliate Programme</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Return & Refund</a>
                    <a class="text-body" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Help & FQAs</a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Vahicle Gallery</h4>
                <div class="row mx-n1">
                    <div class="col-4 px-1 mb-2">
                        <a href=""><img class="w-100" src="img/gallery-1.jpg" alt=""></a>
                    </div>
                    <div class="col-4 px-1 mb-2">
                        <a href=""><img class="w-100" src="img/gallery-2.jpg" alt=""></a>
                    </div>
                    <div class="col-4 px-1 mb-2">
                        <a href=""><img class="w-100" src="img/gallery-3.jpg" alt=""></a>
                    </div>
                    <div class="col-4 px-1 mb-2">
                        <a href=""><img class="w-100" src="img/gallery-4.jpg" alt=""></a>
                    </div>
                    <div class="col-4 px-1 mb-2">
                        <a href=""><img class="w-100" src="img/gallery-5.jpg" alt=""></a>
                    </div>
                    <div class="col-4 px-1 mb-2">
                        <a href=""><img class="w-100" src="img/gallery-6.jpg" alt=""></a>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Newsletter</h4>
                <p class="mb-4">If you see any problems with the page, please let us know or tell us about your experience with us.</p>
                <div class="w-100 mb-3">
                    <div class="input-group">
                        <input type="text" class="form-control bg-dark border-dark" style="padding: 25px;" placeholder="Write here">
                        <div class="input-group-append">
                            <button class="btn btn-primary text-uppercase px-3">Send</button>
                        </div>
                    </div>
                </div>
                <i>We will read your message instantly.</i>
            </div>
        </div>
    </div>
    <div class="container-fluid bg-dark py-4 px-sm-3 px-md-5">
        <p class="mb-2 text-center text-body">&copy; <a href="#">VanguardMotors</a>. All Rights Reserved.</p>
        <p class="m-0 text-center text-body">Designed by <a href="">K2ES SD</a></p>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- Vehicle Detail Script -->
   <script>
    // --- Lógica de Carga Inicial ---
    document.addEventListener('DOMContentLoaded', () => {
        // La lógica para obtener el vehicle_id y cargar los detalles es correcta y genérica.
        const urlParams = new URLSearchParams(window.location.search);
        const vehicleId = urlParams.get('vehicle_id');

        if (!vehicleId) {
            showError('No vehicle ID provided');
            return;
        }

        loadVehicleDetail(vehicleId);
    });

    /**
     * Carga los detalles del vehículo desde el backend.
     * @param {string} vehicleId - ID del vehículo a cargar.
     */
    function loadVehicleDetail(vehicleId) {
        // Si el detalle no abre para todos, la falla generalmente está en el lado del servidor (PHP/SQL)
        // o en la forma en que se construye el enlace en la página anterior.
        // El script JS es genérico para cualquier ID válido.
        const apiUrl = 'backend-scripts/get_vehicle_detail.php?vehicle_id=' + encodeURIComponent(vehicleId);
        
        fetch(apiUrl)
            .then(resp => {
                if (!resp.ok) throw new Error('Network response was not ok: ' + resp.status);
                // Si el vehículo no existe en la DB, el backend debe retornar 'success: false'
                return resp.json();
            })
            .then(json => {
                if (json.success) {
                    renderVehicleDetail(json.data);
                    renderRelatedVehicles(json.related_vehicles, vehicleId);
                } else {
                    // Muestra el error si el backend indica que la carga falló (ej: vehículo no encontrado)
                    showError(json.message || 'Failed to load vehicle details');
                }
            })
            .catch(err => {
                console.error('Error:', err);
                showError('Error loading vehicle details');
            });
    }

    // --- Lógica de Renderizado y Carrusel de Imágenes ---

    /**
     * Renderiza los detalles de un vehículo y configura el carrusel de imágenes.
     * @param {object} vehicle - Objeto con los detalles del vehículo.
     */
    function renderVehicleDetail(vehicle) {
        // Título
        document.getElementById('vehicleTitle').textContent = vehicle.brand + ' ' + vehicle.model;

        // Contenedores
        const mainContainer = document.getElementById('vehicleMainImageContainer');
        const thumbsContainer = document.getElementById('vehicleThumbnailsContainer');
        mainContainer.innerHTML = '';
        thumbsContainer.innerHTML = '';

        // Aseguramos que haya un array de imágenes. El orden (is_main primero) es crucial aquí.
        const images = vehicle.images && vehicle.images.length ? vehicle.images : ['img/car-rent-6.png'];

        // --- Configuración de la Imagen Principal (Visor) ---
        const mainImg = document.createElement('img');
        mainImg.id = 'mainCarouselImage'; 
        mainImg.className = 'img-fluid mb-4 w-100';
        mainImg.src = images[0]; // Imagen inicial (principal)
        mainImg.alt = vehicle.brand + ' ' + vehicle.model;
        mainImg.style.maxHeight = '520px';
        mainImg.style.objectFit = 'cover';
        mainImg.onerror = function() { this.src = 'img/car-rent-6.png'; };
        
        mainContainer.appendChild(mainImg);
        
        // --- Lógica de la Navegación (Carrusel) ---
        let currentImageIndex = 0; // Índice de la imagen actualmente visible

        /**
         * Función para cambiar la imagen principal y actualizar la miniatura activa.
         * @param {number} newIndex - El índice de la nueva imagen a mostrar.
         */
        function changeMainImage(newIndex) {
            // Asegura que el índice esté dentro de los límites
            if (newIndex >= 0 && newIndex < images.length) {
                currentImageIndex = newIndex;
                mainImg.src = images[currentImageIndex]; // Actualiza la imagen principal
                
                // Actualiza el estado activo de las miniaturas
                document.querySelectorAll('#vehicleThumbnailsContainer img').forEach((img, idx) => {
                    img.classList.remove('thumb-active');
                    if (idx === currentImageIndex) {
                        img.classList.add('thumb-active');
                    }
                });
            }
        }
        
        // --- Renderizado de Miniaturas ---
        images.forEach((img, idx) => {
            const col = document.createElement('div');
            col.className = 'col-md-3 col-6 px-2 pb-2 d-inline-block';
            col.style.maxWidth = '25%'; 

            const imgEl = document.createElement('img');
            imgEl.className = 'img-fluid w-100 thumb-image';
            imgEl.src = img;
            imgEl.alt = vehicle.brand + ' ' + vehicle.model + ' thumb ' + (idx+1);
            imgEl.style.cursor = 'pointer';
            imgEl.onerror = function() { this.src = 'img/car-rent-6.png'; };

            // Al hacer clic en una miniatura, CAMBIA la imagen principal
            imgEl.addEventListener('click', function() {
                changeMainImage(idx); // Ahora la miniatura hace la navegación del carrusel
            });

            // Marca la miniatura inicial como activa
            if (idx === 0) {
                imgEl.classList.add('thumb-active');
            }

            col.appendChild(imgEl);
            thumbsContainer.appendChild(col);
        });

        // --- Renderizado de Detalles y Botones ---
        document.getElementById('vehicleDescription').textContent = vehicle.description || 'No description available';
        document.getElementById('vehicleYear').textContent = vehicle.year || '-';
        document.getElementById('vehicleColor').textContent = vehicle.color || '-';
        document.getElementById('vehicleAvailability').textContent = vehicle.availability || '-';
        document.getElementById('vehiclePrice').textContent = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(vehicle.price || 0);

        document.getElementById('reserveBtn').href = 'booking.html?vehicle_id=' + vehicle.vehicle_id;
        document.getElementById('quoteBtn').href = 'quote.html?vehicle_id=' + vehicle.vehicle_id;
    }

    // Eliminamos la función openImageModal ya que no se necesita el pop-up.

    // La función renderRelatedVehicles se mantiene igual para el carrusel de vehículos relacionados.
    function renderRelatedVehicles(vehicles, currentVehicleId) {
        const container = document.getElementById('relatedVehiclesContainer');
        container.innerHTML = '';
        
        if (vehicles && vehicles.length > 0) {
            // Código de destrucción y reconstrucción de Owl Carousel...
            if ($(container).hasClass('owl-loaded')) {
                $(container).trigger('destroy.owl.carousel');
                $(container).removeClass('owl-loaded');
                $(container).find('.owl-stage-outer').children().unwrap();
            }

            vehicles.forEach(v => {
                // Código para construir la tarjeta de vehículo relacionado...
                const item = document.createElement('div');
                item.className = 'item';

                const card = document.createElement('div');
                card.className = 'rent-item mb-4 text-center';

                const img = document.createElement('img');
                img.className = 'img-fluid mb-4';
                img.src = v.primary_image || (v.images && v.images[0]) || 'img/car-rent-6.png';
                img.alt = (v.brand || '') + ' ' + (v.model || '');
                img.onerror = function() { this.src = 'img/car-rent-6.png'; };

                const title = document.createElement('h4');
                title.className = 'text-uppercase mb-4';
                title.textContent = (v.brand || '') + ' ' + (v.model || '');

                const price = document.createElement('h3');
                price.className = 'text-primary mb-3';
                price.textContent = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(v.price || 0);

                const meta = document.createElement('div');
                meta.className = 'd-flex justify-content-center mb-4';
                meta.innerHTML = `
                    <div class="px-2"><i class="fa fa-car text-primary mr-1"></i><span>${v.year || ''}</span></div>
                    <div class="px-2 border-left border-right d-flex align-items-center"><i class="fa fa-paint-brush text-primary mr-2"></i><span>${v.color || ''}</span></div>
                    <div class="px-2"><i class="fa fa-check-circle text-primary mr-1"></i><span class="font-weight-bold ${v.availability && v.availability.toLowerCase() === 'available' ? 'text-success' : 'text-danger'}">${v.availability || ''}</span></div>
                `;

                const btn = document.createElement('a');
                btn.className = 'btn btn-primary px-3';
                btn.href = 'detail.html?vehicle_id=' + encodeURIComponent(v.vehicle_id || '');
                btn.textContent = 'View Details';

                card.appendChild(img);
                card.appendChild(title);
                card.appendChild(price);
                card.appendChild(meta);
                card.appendChild(btn);

                item.appendChild(card);
                container.appendChild(item);
            });

            // Inicializa Owl Carousel
            $(document).ready(function() {
                $('#relatedVehiclesContainer').owlCarousel({
                    loop: false,
                    margin: 24,
                    nav: true,
                    dots: false,
                    navText: ['<i class="fa fa-chevron-left"></i>', '<i class="fa fa-chevron-right"></i>'],
                    responsive: {
                        0: { items: 1 },
                        576: { items: 1 },
                        768: { items: 2 },
                        992: { items: 3 }
                    }
                });
            });

        } else {
            container.innerHTML = '<div class="text-center"><p class="text-muted">No related vehicles found</p></div>';
        }
    }

    function showError(msg) {
        document.getElementById('vehicleTitle').textContent = 'Error loading vehicle';
        document.getElementById('vehicleDescription').textContent = msg;
        document.getElementById('vehicleMainImageContainer').innerHTML = ''; 
        document.getElementById('vehicleThumbnailsContainer').innerHTML = '';
    }
</script>
</body>

</html>